import javax.management.MBeanServer;
import javax.management.ObjectName;
import java.lang.management.ManagementFactory;

public class EhcacheJmxStatsLogger {

    public static void logEhcacheStats(String cacheAlias, String cacheManagerName) {
        try {
            MBeanServer mBeanServer = ManagementFactory.getPlatformMBeanServer();

            String jmxObjectName = String.format(
                "org.ehcache:type=CacheStatistics,CacheManager=%s,Cache=%s",
                ObjectName.quote(cacheManagerName),
                ObjectName.quote(cacheAlias)
            );

            ObjectName objectName = new ObjectName(jmxObjectName);

            Long hitCount = (Long) mBeanServer.getAttribute(objectName, "CacheHits");
            Long missCount = (Long) mBeanServer.getAttribute(objectName, "CacheMisses");
            Long putCount = (Long) mBeanServer.getAttribute(objectName, "CachePuts");
            Long removalCount = (Long) mBeanServer.getAttribute(objectName, "CacheRemovals");
            Long size = (Long) mBeanServer.getAttribute(objectName, "Size");

            System.out.println("Cache Name: " + cacheAlias);
            System.out.println("Hits: " + hitCount);
            System.out.println("Misses: " + missCount);
            System.out.println("Puts: " + putCount);
            System.out.println("Removals: " + removalCount);
            System.out.println("Size (entry count): " + size);

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
